# 🎮 交互式菜单使用指南

## 📦 安装

将 `menu.py` 复制到项目根目录：

```
H:\Project_python\stock\test_evaluation\menu.py
```

## 🚀 启动方式

### 方式 1: 直接运行（推荐）

```cmd
cd H:\Project_python\stock\test_evaluation
python menu.py
```

### 方式 2: 创建快捷方式（Windows）

1. **创建批处理文件** `启动量化引擎.bat`:

```batch
@echo off
title 量化交易引擎
cd /d H:\Project_python\stock\test_evaluation
python menu.py
pause
```

2. **双击运行** `启动量化引擎.bat`

### 方式 3: 创建桌面快捷方式

右键 `menu.py` → 发送到 → 桌面快捷方式

---

## 📋 功能说明

### 系统管理模块

#### 1. 📦 初始化数据库
- **功能**: 首次运行必选，下载全量历史数据
- **时间**: 约 30-60 分钟
- **选项**: 
  - 自动检测进程数（推荐）
  - 4/8 个进程
  - 自定义进程数

#### 2. 📈 每日数据更新
- **功能**: 增量下载最新数据
- **时间**: 约 5-10 分钟
- **模式**:
  - 增量更新：只下载新数据（推荐）
  - 全量更新：重新下载所有数据

#### 3. 🔧 系统信息查看
- 数据库路径
- 日志目录
- 配置参数
- 版本信息

#### 4. 🔍 环境诊断检查
- Python 版本检查
- 依赖包检查
- 模块导入测试
- 文件完整性检查

---

### 回测分析模块

#### 5. 🎯 RSRS 策略回测
- **策略**: RSRS 择时策略
- **参数**: 可自定义日期、资金、调仓频率

#### 6. 📊 动量策略回测
- **策略**: 动量策略
- **参数**: 可自定义日期、资金、调仓频率

#### 7. ⚙️ 自定义回测参数
- 完全自定义所有回测参数
- 支持所有可用策略

**参数说明**:
- **开始日期**: 回测起始日期（如 2020-01-01）
- **结束日期**: 回测结束日期（如 2023-12-31）
- **初始资金**: 初始投入资金（如 1000000）
- **调仓频率**: 
  - D: 每日调仓
  - W: 每周调仓（推荐）
  - M: 每月调仓

---

### 市场分析模块

#### 8. 🔎 全市场扫描
- **功能**: 扫描全市场，找出符合条件的金股
- **参数**:
  - 扫描日期（默认今天）
  - 显示数量（默认 50）

#### 9. 🏥 单股诊断
- **功能**: 诊断单只股票的技术指标
- **输入**: 股票代码（如 000001）
- **输出**: 详细诊断报告

---

### 高级功能模块

#### 10. 🌐 节点速度测试
- **功能**: 测试所有通达信服务器节点速度
- **输出**: 按延迟排序的节点列表
- **用途**: 找出最快的数据源

#### 11. 💾 数据库管理
- **查看统计**: 总行数、股票数、日期范围
- **压缩数据库**: 减小数据库文件大小
- **完整性检查**: 检查数据是否完整
- **清空数据库**: ⚠️ 危险操作，不可恢复

#### 12. 📝 查看日志
- 查看系统运行日志
- 显示最近 50 行
- 可选择不同日期的日志文件

---

## 🎯 典型使用流程

### 首次使用

```
1. 运行 menu.py
2. 选择 4 → 环境诊断检查
3. 如果通过，选择 1 → 初始化数据库
4. 等待下载完成（30-60分钟）
5. 选择 5 → 运行 RSRS 策略回测
6. 查看结果
```

### 日常使用

```
1. 运行 menu.py
2. 选择 2 → 每日数据更新（增量）
3. 选择 8 → 全市场扫描
4. 查看今日金股
5. 选择 9 → 诊断感兴趣的股票
```

### 定期维护

```
每周:
- 选择 11 → 数据库管理 → 查看统计
- 选择 12 → 查看日志

每月:
- 选择 11 → 数据库管理 → 压缩数据库
- 选择 4 → 环境诊断检查
```

---

## ⌨️ 快捷键说明

- **数字键**: 选择菜单功能
- **Enter**: 确认输入/继续
- **Ctrl+C**: 中断当前操作
- **0**: 退出系统

---

## 💡 使用技巧

### 技巧 1: 后台运行长时间任务

对于初始化数据库这种长时间任务，可以：

```cmd
# 使用 nohup (Linux/Mac)
nohup python menu.py &

# 使用 start (Windows)
start /B python menu.py
```

### 技巧 2: 查看实时日志

在另一个命令行窗口：

```cmd
cd H:\Project_python\stock\test_evaluation\data\logs
tail -f quant_2026-01-27.log
```

### 技巧 3: 快速诊断问题

遇到问题时：
1. 选择 4 → 环境诊断
2. 选择 12 → 查看日志
3. 根据错误信息修复

### 技巧 4: 批量操作

虽然菜单是交互式的，但你仍可以直接使用命令行：

```cmd
# 更新数据
python main.py update

# 扫描市场
python main.py scan --top 100

# 诊断股票
python main.py diagnose 000001
```

---

## 🎨 界面示例

```
======================================================================
                    🚀 量化交易引擎 v1.0                    
======================================================================

📋 主菜单
----------------------------------------------------------------------
  【系统管理】
    1. 📦 初始化数据库 (首次运行必选)
    2. 📈 每日数据更新
    3. 🔧 系统信息查看
    4. 🔍 环境诊断检查

  【回测分析】
    5. 🎯 运行策略回测 (RSRS)
    6. 📊 运行策略回测 (动量)
    7. ⚙️  自定义回测参数

  【市场分析】
    8. 🔎 全市场扫描 (今日金股)
    9. 🏥 单股诊断分析

  【高级功能】
    10. 🌐 节点速度测试
    11. 💾 数据库管理
    12. 📝 查看日志

  【其他】
    0. 🚪 退出系统
----------------------------------------------------------------------
请选择功能 [0-12]: _
```

---

## 🔧 自定义菜单

如果想添加新功能，编辑 `menu.py`:

```python
# 1. 添加功能函数
def my_new_feature():
    """我的新功能"""
    clear_screen()
    print_header()
    print("🆕 我的新功能")
    print("=" * 70)
    
    # 你的代码
    
    wait_for_enter()

# 2. 在 print_menu() 中添加菜单项
print("    13. 🆕 我的新功能")

# 3. 在 main() 中注册
menu_actions = {
    # ... 其他功能
    '13': my_new_feature,
}
```

---

## ⚠️ 注意事项

1. **首次运行**: 必须先选择 1 初始化数据库
2. **网络要求**: 需要能访问通达信服务器
3. **磁盘空间**: 至少需要 5GB 可用空间
4. **运行时间**: 初始化约需 30-60 分钟
5. **中断恢复**: 初始化被中断后可重新运行

---

## 🆘 常见问题

### Q: 菜单无法启动？

**A**: 检查:
1. 是否在正确目录
2. Python 是否安装
3. 依赖是否安装: `pip install -r requirements.txt`

### Q: 初始化失败？

**A**: 
1. 选择 4 → 环境诊断
2. 选择 10 → 节点速度测试
3. 检查网络连接

### Q: 更新数据失败？

**A**:
1. 选择 11 → 数据库管理 → 检查完整性
2. 选择 12 → 查看日志
3. 必要时重新初始化

### Q: 回测没有结果？

**A**: 检查:
1. 数据库是否有数据
2. 日期范围是否正确
3. 策略参数是否合理

---

## 📞 获取帮助

- 环境诊断: 选择菜单 4
- 查看日志: 选择菜单 12
- 系统信息: 选择菜单 3

---

**文档版本**: v1.0  
**最后更新**: 2026-01-27  
**适用系统**: Windows / Linux / macOS
